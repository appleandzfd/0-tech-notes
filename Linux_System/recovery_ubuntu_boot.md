在使用星哥给的硬盘工具扩容后，发现grub损坏，系统无法启动，WinXP 和 Ubuntu都无法启动，记录一下修复过程：

问题起因： 将D盘切割为两个磁盘，然后企图将分出来的新盘和C盘合并，不料切割之后系统就无法启动，原因应该是跟硬盘的分区编号修改有关。

1. 修复WinXP。 使用WinPE工具最简单，直接借用星哥的U盘工具，引导进入系统，然后选择里面的硬盘工具，选中XP系统所在的盘，重写MBR即可。重启之后，发现Windows系统都找到了，并且能够进入系统正常工作。

2. 修复Ubuntu。这个过程比较复杂，感谢超哥和星哥的帮助。

(1) 制作Ubuntu启动盘，我这里装机系统为Ubuntu 10.04， U盘系统为 11. 04，不过系统不同也不影响。

(2) 利用U盘进入LiveCD系统，打开terminal，此时已经装好了grub2，可以执行 update-grub2 来更新grub.cfg文件。但是重启之后，发现仍然没有Ubuntu系统，原因应该时MBR的信息丢失，仍然找不到。

(3) 为此需要重装grub，通过man grub-install可以查看相关命令的详细情形，这里只需要注意两点，首先是要写入哪个grub文件，由于原来我的Ubuntu系统装载/dev/sda10下面，因此，首先我们先mount这个分区到/mnt/tmp下面，执行

mount /dev/sda10 /mnt/tmp

然后，执行命令： grub-install --boot-diretory=/mnt/tmp/boot /dev/sda

这条命令的意思就是，把我们待修复系统的grub信息，写入到硬盘的MBR中。

执行之后，如果提示no error detect，就可以重启了。

重启之后，发现出现了熟悉的grub菜单，选择Ubuntu系统，进入，即可。

另外，上面可能有些系统菜单还不全，所以进入Ubuntu系统后，再次执行一下：update-grub2命令，就可以找到之前全部的启动项。

至此，系统都找回来了。

=============================================================================
后记：
出现incompitable lisence的提示信息说明还没有安装正确，注意上面安装路径使用是使用的/mnt/tmp，也就是一个自定义的路径，不要使用/，因为/已经挂载的是U盘系统的启动，而不是你的系统的启动。

如果安装成功了，但是进不了系统，启动的话会出现grub的提示菜单，grub功能正常，就是命令行形式。说明还是grub.cfg文件有问题，grub没问题，只是因为你执行update-grub2生成的grub.cfg文件是在根目录下面，而你待启动的系统不是挂载在根目录下面，所以那里面的grub.cfg并没有更新。解决办法就是将/boot/grub下面的grub.cfg文件拷贝到你待恢复系统的/boog/grub下面，这样下次启动就OK了。
另外，如果启动提示某个参数有问题，修改grub.cfg文件，将其中的search行中set后面加上=root。
